<% enrolled = local_assigns.fetch(:enrolled, true) %>

<div class="flex h-full flex-col">
  <% if course.cover_image.attached? %>
    <% thumb = (course.cover_image.variant(resize_to_fill: [2000, 1125]).processed rescue nil) %>
    <div class="relative overflow-hidden rounded-none bg-black lg:rounded-l-none">
      <% if thumb %>
        <%= image_tag thumb, class: "h-[38vh] w-full object-cover opacity-95 md:h-[45vh]" %>
      <% else %>
        <%= image_tag rails_blob_path(course.cover_image, disposition: "inline"), class: "h-[38vh] w-full object-cover opacity-95 md:h-[45vh]" %>
      <% end %>

      <div class="absolute inset-x-0 bottom-0">
        <div class="h-28 bg-gradient-to-t from-black/80 to-transparent"></div>
        <div class="absolute inset-x-0 bottom-0 p-6">
          <div class="text-center">
            <div class="text-3xl font-extrabold tracking-tight text-white md:text-4xl"><%= course.name.to_s.upcase %></div>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <div class="rounded-2xl border border-gray-200 bg-white p-8 shadow-sm">
      <div class="text-center text-3xl font-extrabold tracking-tight text-gray-900 md:text-4xl"><%= course.name.to_s.upcase %></div>
    </div>
  <% end %>

  <div class="flex-1 overflow-y-auto bg-white">
    <div class="mx-auto max-w-3xl px-6 py-8">
      <% if course.description&.body&.present? %>
        <div class="text-gray-800"><%= course.description %></div>
      <% else %>
        <p class="text-gray-500">Popis brzy doplníme.</p>
      <% end %>

      <% if enrolled %>
        <div class="mt-8 rounded-2xl border border-gray-200 bg-gray-50 p-5 text-sm text-gray-700">
          Vyberte segment vlevo pro přehrání videa.
        </div>
      <% else %>
        <div class="mt-8 rounded-2xl border border-gray-200 bg-gray-50 p-5">
          <div class="text-sm font-semibold text-gray-900">Kurz ještě nemáte zakoupený.</div>
          <div class="mt-2 flex flex-wrap items-center justify-between gap-3">
            <div class="text-sm text-gray-600">
              Cena: <span class="font-semibold text-gray-900"><%= number_to_currency(course.price, unit: course.currency, precision: course.display_precision) %></span>
            </div>
            <%= button_to "Koupit nyní",
                          cart_items_path(course_id: course.id),
                          method: :post,
                          data: { turbo: false, turbo_submits_with: "Přidávám..." },
                          class: "inline-flex items-center justify-center rounded-xl bg-gray-900 px-4 py-2.5 text-sm font-semibold text-white hover:bg-black" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

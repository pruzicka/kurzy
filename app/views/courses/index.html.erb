<% content_for :title, "Kurzy" %>
<% meta_description "Online kurzy, e-booky a tréninky. Začněte studovat ještě dnes." %>
<% og_title "Kurzy" %>
<% canonical_url courses_url %>

<div class="w-full">
  <div class="flex items-end justify-between gap-4">
    <h1 class="text-3xl font-semibold tracking-tight">Kurzy</h1>
    <%= link_to "Zpět na úvod", root_path, class: "text-sm font-medium text-gray-900 hover:underline" %>
  </div>

  <% if @tags.any? %>
    <div class="mt-4 flex flex-wrap gap-2">
      <% if @active_tag %>
        <%= link_to "Vše", courses_path, class: "rounded-full border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50" %>
      <% else %>
        <span class="rounded-full border border-gray-900 bg-gray-900 px-3 py-1.5 text-xs font-medium text-white">Vše</span>
      <% end %>
      <% @tags.each do |tag| %>
        <% if @active_tag == tag %>
          <span class="rounded-full border border-gray-900 bg-gray-900 px-3 py-1.5 text-xs font-medium text-white"><%= tag.name %></span>
        <% else %>
          <%= link_to tag.name, courses_path(tag: tag.slug), class: "rounded-full border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50" %>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <div class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2">
    <% @courses.each do |course| %>
      <div class="group rounded-2xl border border-gray-200 bg-white p-6 shadow-sm hover:border-gray-300">
        <div class="flex flex-col gap-3">
          <% if course.cover_image.attached? %>
            <% thumb = (course.cover_image.variant(resize_to_fill: [1200, 675]).processed rescue nil) %>
            <%= link_to course_show_path(course), class: "overflow-hidden rounded-2xl border border-gray-200 bg-white" do %>
              <% if thumb %>
                <%= image_tag thumb, class: "h-40 w-full object-cover" %>
              <% else %>
                <%= image_tag rails_blob_path(course.cover_image, disposition: "inline"), class: "h-40 w-full object-cover" %>
              <% end %>
            <% end %>
          <% end %>
          <div class="flex items-start justify-between gap-4">
            <div>
              <h2 class="text-lg font-semibold tracking-tight">
                <%= link_to course.name, course_show_path(course), class: "hover:underline" %>
              </h2>
              <% if course.tags.any? %>
                <div class="mt-1 flex flex-wrap gap-1">
                  <% course.tags.each do |tag| %>
                    <span class="rounded-full bg-indigo-50 border border-indigo-200 px-2 py-0.5 text-[10px] font-medium text-indigo-700"><%= tag.name %></span>
                  <% end %>
                </div>
              <% end %>
            </div>
            <span class="shrink-0 rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-700">
              <%= number_to_currency(course.price, unit: course.currency, precision: course.display_precision) %>
            </span>
          </div>
          <%# Keep the "Už zakoupeno" badge below; no duplicate label here. %>
          <% if course.description&.body&.present? %>
            <div class="prose prose-sm prose-gray max-w-none">
              <%= course.description %>
            </div>
          <% else %>
            <p class="text-sm text-gray-500">Popis brzy doplníme.</p>
          <% end %>
          <% if user_signed_in? %>
            <div class="pt-2">
              <% if current_user.enrollments.exists?(course_id: course.id) %>
                <span class="inline-flex items-center justify-center rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs font-semibold text-emerald-900">
                  Už zakoupeno
                </span>
              <% else %>
                <%= button_to "Přidat do košíku",
                              cart_items_path(course_id: course.id),
                              method: :post,
                              data: { turbo: false, turbo_submits_with: "Přidávám..." },
                              class: "inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-3 py-2 text-xs font-semibold text-gray-900 hover:bg-gray-50" %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

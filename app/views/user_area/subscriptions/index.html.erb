<div class="w-full">
  <div class="flex items-end justify-between gap-4">
    <div class="flex flex-col gap-1">
      <h1 class="text-3xl font-semibold tracking-tight">Moje předplatné</h1>
    </div>
  </div>

  <% if @subscriptions.any? %>
    <div class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2">
      <% @subscriptions.each do |subscription| %>
        <% plan = subscription.subscription_plan %>
        <div class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h2 class="text-lg font-semibold tracking-tight">
                <%= link_to plan.name, subscription_plan_path(plan.slug), class: "hover:underline" %>
              </h2>
              <p class="mt-1 text-xs text-gray-600"><%= subscription.interval == "year" ? "Roční" : "Měsíční" %> předplatné</p>
            </div>
            <% badge =
              case subscription.status
              when "active" then "bg-emerald-50 text-emerald-900 border-emerald-200"
              when "past_due" then "bg-amber-50 text-amber-900 border-amber-200"
              when "canceled" then "bg-gray-100 text-gray-700 border-gray-200"
              else "bg-gray-100 text-gray-700 border-gray-200"
              end
            %>
            <span class="inline-flex rounded-full border px-2.5 py-1 text-xs font-medium <%= badge %>"><%= subscription.status %></span>
          </div>

          <% if subscription.current_period_end.present? %>
            <p class="mt-3 text-xs text-gray-500">
              <% if subscription.cancel_at_period_end? %>
                Platné do: <%= subscription.current_period_end.strftime("%d.%m.%Y") %>
              <% else %>
                Další platba: <%= subscription.current_period_end.strftime("%d.%m.%Y") %>
              <% end %>
            </p>
          <% end %>

          <% if subscription.access_granted? %>
            <div class="mt-4 flex gap-2">
              <% if subscription.cancel_at_period_end? %>
                <%= button_to "Obnovit", resume_user_subscription_path(subscription), method: :patch, class: "rounded-xl border border-gray-300 bg-white px-3 py-2 text-xs font-semibold text-gray-900 hover:bg-gray-50" %>
              <% else %>
                <%= button_to "Zrušit předplatné", cancel_user_subscription_path(subscription), method: :patch, data: { turbo_confirm: "Opravdu chcete zrušit předplatné? Přístup ztratíte na konci aktuálního období." }, class: "rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-semibold text-rose-900 hover:bg-rose-100" %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="mt-6 rounded-2xl border border-dashed border-gray-300 bg-gray-50 p-8 text-gray-700">
      Zatím nemáte žádné předplatné.
    </div>
    <div class="mt-6">
      <%= link_to "Zobrazit předplatné", subscription_plans_path, class: "inline-flex items-center justify-center rounded-2xl bg-gray-900 px-4 py-2.5 text-sm font-medium text-white hover:bg-black" %>
    </div>
  <% end %>
</div>
